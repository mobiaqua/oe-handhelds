From 1fa2bcfb8dbdb4bc8199d0ef1701a101857d4361 Mon Sep 17 00:00:00 2001
From: ubuntu <ubuntu@natty-panda.(none)>
Date: Thu, 14 Apr 2011 23:35:26 -0300
Subject: [PATCH] Avoid calling set_max_mpu_wakeup_lat as it's not available at .38

Signed-off-by: Ricardo Salveti de Araujo <ricardo.salveti@canonical.com>
---
 sgx/services4/system/omap4/sysutils_linux.c |   13 ++-----------
 1 files changed, 2 insertions(+), 11 deletions(-)

diff --git a/sgx/services4/system/omap4/sysutils_linux.c b/sgx/services4/system/omap4/sysutils_linux.c
index bc02e0d..13a478a 100755
--- a/sgx/services4/system/omap4/sysutils_linux.c
+++ b/sgx/services4/system/omap4/sysutils_linux.c
@@ -40,8 +40,6 @@
 
 #include <linux/platform_device.h>
 #include <linux/pm_runtime.h>
-#include <plat/gpu.h>
-#include <plat/omap_device.h>
 
 #define	ONE_MHZ	1000000
 #define	HZ_TO_MHZ(m) ((m) / ONE_MHZ)
@@ -54,7 +52,6 @@
 
 #if defined(LDM_PLATFORM) && !defined(PVR_DRI_DRM_NOT_PCI)
 extern struct platform_device *gpsPVRLDMDev;
-static struct pm_qos_request_list *qos_request;
 #endif
 
 static IMG_VOID PowerLockWrap(SYS_SPECIFIC_DATA *psSysSpecData)
@@ -157,12 +154,8 @@ PVRSRV_ERROR EnableSGXClocks(SYS_DATA *psSysData)
 
 #if defined(LDM_PLATFORM) && !defined(PVR_DRI_DRM_NOT_PCI)
 	{
-		int res;
 
-		((struct gpu_platform_data*)gpsPVRLDMDev->dev.platform_data)->set_max_mpu_wakeup_lat(&qos_request, 0);
-		omap_device_set_rate(&gpsPVRLDMDev->dev, &gpsPVRLDMDev->dev,
-				SYS_SGX_CLOCK_SPEED);
-		res = pm_runtime_get_sync(&gpsPVRLDMDev->dev);
+		int res = pm_runtime_get_sync(&gpsPVRLDMDev->dev);
 		if (res < 0)
 		{
 			PVR_DPF((PVR_DBG_ERROR, "EnableSGXClocks: pm_runtime_get_sync failed (%d)", -res));
@@ -199,13 +192,11 @@ IMG_VOID DisableSGXClocks(SYS_DATA *psSysData)
 
 #if defined(LDM_PLATFORM) && !defined(PVR_DRI_DRM_NOT_PCI)
 	{
-		int res = pm_runtime_put_sync(&gpsPVRLDMDev->dev);
+		int res = 0; // XXX TL .38  pm_runtime_put_sync(&gpsPVRLDMDev->dev);
 		if (res < 0)
 		{
 			PVR_DPF((PVR_DBG_ERROR, "DisableSGXClocks: pm_runtime_put_sync failed (%d)", -res));
 		}
-		((struct gpu_platform_data*)gpsPVRLDMDev->dev.platform_data)->set_max_mpu_wakeup_lat(&qos_request, -1);
-		omap_device_set_rate(&gpsPVRLDMDev->dev, &gpsPVRLDMDev->dev, 0);
 	}
 #endif
 
-- 
1.7.4.1

